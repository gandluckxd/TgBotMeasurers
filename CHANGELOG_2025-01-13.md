# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç 2025-01-13: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏–∑ AmoCRM

–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç—Ä–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—è –∏–∑ AmoCRM, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ –∑–∞–º–µ—Ä–∞—Ö:

- **–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞** (ID –ø–æ–ª—è: 667253) - ‚Ññ –≤ –ê–ª—å—Ç–∞–≤–∏–Ω –û—Å–Ω–æ–≤–Ω–æ–π
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫–æ–Ω** (ID –ø–æ–ª—è: 676403)
- **–ü–ª–æ—â–∞–¥—å –æ–∫–æ–Ω** (ID –ø–æ–ª—è: 808751)

### 2. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Ñ–æ—Ä–º–∞—Ç –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:
1. **–ó–∞–≥–æ–ª–æ–≤–æ–∫** - –ó–∞–º–µ—Ä # –∏–ª–∏ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞
2. **–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ**
   - –°–¥–µ–ª–∫–∞
   - –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
   - –ê–¥—Ä–µ—Å
   - –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
3. **–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - –ö–æ–Ω—Ç–∞–∫—Ç (–∏–º—è)
   - –¢–µ–ª–µ—Ñ–æ–Ω
   - –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –≤ AmoCRM
4. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫–æ–Ω**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫–æ–Ω
   - –ü–ª–æ—â–∞–¥—å –æ–∫–æ–Ω
5. **–°—Ç–∞—Ç—É—Å –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ**
   - –°—Ç–∞—Ç—É—Å –∑–∞–º–µ—Ä–∞
   - –ó–∞–º–µ—Ä—â–∏–∫ (–µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω)
6. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** (—Ç–æ–ª—å–∫–æ –≤ –¥–µ—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ)
   - ID —Å–¥–µ–ª–∫–∏ –≤ AmoCRM
   - –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 3. –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### `database/models.py`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `order_number`, `windows_count`, `windows_area` –≤ –º–æ–¥–µ–ª—å `Measurement`
- –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_info_text()` –¥–ª—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

#### `services/amocrm.py`
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `extract_custom_field_value()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π –ø–æ ID

#### `bot/utils/notifications.py`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `format_lead_info_for_notification()` —Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –∏–∑ AmoCRM

#### `server/webhook.py`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_create_measurement_from_lead()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–µ–π: order_number (667253), windows_count (676403), windows_area (808751)

#### `database/database.py`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `create_measurement()` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

### 4. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ `migrations/migrate.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `measurements`:
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π: `order_number`, `windows_count`, `windows_area`
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞

–ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (11 –∑–∞–ø–∏—Å–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã).

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π
2. **–ü–æ–ª–Ω–æ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–∫–∞–∑–∞ (–Ω–æ–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –ø–ª–æ—â–∞–¥—å –æ–∫–æ–Ω)
3. **–£–¥–æ–±—Å—Ç–≤–æ** - –ª–µ–≥—á–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—é –ø–æ–ª–µ–π
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —É–ø—Ä–æ—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –±—É–¥—É—â–µ–º

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –¥—Ä—É–≥–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
./venv/Scripts/python.exe migrations/migrate.py
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞ - –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –Ω–æ–≤—É—é.

## ID –ø–æ–ª–µ–π AmoCRM –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

- `667253` - ‚Ññ –≤ –ê–ª—å—Ç–∞–≤–∏–Ω –û—Å–Ω–æ–≤–Ω–æ–π (order_number)
- `676403` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫–æ–Ω (windows_count)
- `808751` - –ü–ª–æ—â–∞–¥—å –æ–∫–æ–Ω (windows_area)
- `809475` - –ê–¥—Ä–µ—Å (address)
- `808753` - –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ (delivery_zone)

## –ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

```
üìã –ó–∞–º–µ—Ä #15

üìÑ –°–¥–µ–ª–∫–∞: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫–æ–Ω –≤ –∫–≤–∞—Ä—Ç–∏—Ä—É
üî¢ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: 2025-0123
üìç –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 10, –∫–≤. 25
üöö –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏: –¶–µ–Ω—Ç—Ä

üë§ –ö–æ–Ω—Ç–∞–∫—Ç: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
üë®‚Äçüíº –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –≤ AmoCRM: –ü–µ—Ç—Ä–æ–≤ –ü.–ü.

ü™ü –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫–æ–Ω: 5
üìê –ü–ª–æ—â–∞–¥—å –æ–∫–æ–Ω: 12.5 –º¬≤

üìä –°—Ç–∞—Ç—É—Å: üìã –í —Ä–∞–±–æ—Ç–µ
üë∑ –ó–∞–º–µ—Ä—â–∏–∫: –°–∏–¥–æ—Ä–æ–≤ –°–µ—Ä–≥–µ–π

üÜî ID —Å–¥–µ–ª–∫–∏ –≤ AmoCRM: 123456
üìÖ –°–æ–∑–¥–∞–Ω–æ: 13.01.2025 10:30
üìÖ –ù–∞–∑–Ω–∞—á–µ–Ω–æ: 13.01.2025 10:35
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ AmoCRM, –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è (—Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º NULL)
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ –Ω–∞—Ä—É—à–µ–Ω
